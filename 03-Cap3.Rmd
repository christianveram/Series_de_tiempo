# Preprocesamiento y visualización.

## Estacionariedad

Una serie temporal estacionaria es aquella cuyas propiedades no dependen del momento en que se observa .Por lo tanto, las series temporales con tendencias o con estacionalidad no son estacionarias: la tendencia y la estacionalidad afectarán el valor de la serie temporal en diferentes momentos. Una serie temporal estacionaria no presenta patrones predecibles a largo plazo. 

Esto implica que si la serie es estacionaria, estariamos prediciendo que las características estadísticas de nuestra serie de tiempo serán las mismas en el futuro como en el pasado.

Para poder comprobar si la serie es estacionaria se puede utilizar algunos métodos estadísticos, entre los más utilizados se encuentran la prueba de Dickey-Fuller Aumentada (ADF) y la prueba de Kwiatkowski-Phillips-Schmidt-Shin (KPSS). Para nuestro caso usamos las dos pruebas como se muestran a continuación:


```{r, include=F, message=FALSE, warning=FALSE}
library(knitr)
library(kableExtra)
library(tidyverse)
library(lubridate)
library(zoo)
library(forecast)

url <- "https://raw.githubusercontent.com/christianveram/Series_de_tiempo/refs/heads/main/bases/temperaturas_final.csv"
datos <- read.csv(url)
datos$time <- as.Date(datos$time)

datos_filtrados <- datos %>%
  mutate(fecha = as.Date(time)) %>%
  arrange(fecha)  %>%
  filter(fecha >= as.Date("1975-01-01"))

# 'tavg' a dos decimales
datos_filtrados <- datos_filtrados %>%
  mutate(tavg = round(tavg, 2))
```


```{r, warning=FALSE}
#Prueba de Dicker-Fuller
#Ho: La serie no presenta estacionariedad
#Ha: La serie presenta estacionariedad
library(tseries)
adf.test(datos_filtrados$tavg)
```

Con un p valor=0.01 se rechaza la hipotesis nula y esto indica que la serie para la variable de temperatura promedio es estacionaria.

```{r, warning=FALSE}
#Ho: La serie es estacionaria
#Ha: La serie no es estacionaria
kpss.test(datos_filtrados$tavg)
```

El  p valor es igual 0,01. Dado que este valor es menor que el nivel de significancia de 0,05, se rechaza la hipótesis nula. Esto indica que la serie temporal no es estacionaria en cuanto a tendencia.

Entonces con las pruebas anteriores se puede concluir que la serie es estacionaria en diferencias (test de ADF) y no en tendencia (test KPSS), por lo que es recomendable realizar el proceso de diferenciación. 

## Diferenciación

La diferenciación es una técnica utilizada en el análisis de series temporales para hacer que una serie no estacionaria se vuelva estacionaria. Esto se logra calculando las diferencias entre valores consecutivos de la serie temporal. Así mismo, la diferenciación ayuda a eliminar las tendencias en los datos, haciendo que la serie sea estacionaria. Además, facilita el Modelado ya que al hacer que la serie sea estacionaria, se facilita la aplicación de modelos de series temporales como ARIMA.

Para la variable de temperatura promedio se aplicó una diferenciación de primer orden, la cual calcula la diferencia entre cada valor y el anterior.

Posteriormente se realizó nuevamente los test estadísticos de comprobación de la estacionariedad.

```{r, warning=FALSE}
estacionariedad=diff(datos_filtrados$tavg)
adf.test(estacionariedad)
kpss.test(estacionariedad)
```
Finalmente, se puede concluir en los dos test estadísticos con un nivel de confianza del 95% que la serie es estacionaria. 

```{r}
#Correlograma de la serie original
acf(estacionariedad, lag.max=34)
```

**Figura 3.1** Correlograma de la serie de temperatura promedio de la ciudad de Bogotá DC.


En el correlograma, el Lag 1, hay una barra que sobrepasa significativamente el límite de confianza inferior (es negativa y relativamente grande), lo que indica una autocorrelación negativa significativa en el primer rezago. Indicando que hay una tendencia a que si el valor actual es alto, el valor del período anterior fue bajo o viceversa.
Posteriormente las barras de los rezagos se encuentran dentro de los límites de confianza. Esto sugiere que no hay una autocorrelación significativa para estos rezagos. La dependencia con valores más lejanos en el pasado parece ser débil.



